(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class h{aspects_data;connections;primal;compound;weights;MAX_SEARCH_DEPTH;constructor(){this.aspects_data={},this.connections={},this.primal=[],this.compound=[],this.weights={},this.MAX_SEARCH_DEPTH=10}static async create(){const t=new h;return await t.initialize(),t}findSolution(t,e,o){let s=1/0,i=null;if(!this.isValidAspect(t)||!this.isValidAspect(e))throw new Error("Invalid aspect provided");const a=(m,p,w,l)=>{if(l.length>this.MAX_SEARCH_DEPTH)return;if(m===w&&l.length===o){p<s&&(s=p,i=l);return}let g=this.connections[m];if(g)for(let d of g){let A=p+(this.weights[d]||0);A>=s||a(d,A,w,[...l,d])}};return a(t,0,e,[t]),{path:i,weight:s}}async initialize(){let t=await fetch("/aspects.json");if(!t.ok)throw new Error("Failed to fetch aspects data");this.aspects_data=await t.json(),this.initializeAspects(),this.createValidConnections(),this.findAspectWeight()}initializeAspects(){this.primal=this.aspects_data.primal,this.compound=this.aspects_data.compound;for(const t of[...this.primal,...this.compound])this.connections[t]=[];for(const t of this.primal)this.weights[t]=1}findAspectWeight(){const t=(e,o)=>{if(e in this.weights)return this.weights[e];if(o.has(e))return 0;let s=0,i=this.aspects_data.combinations[e]||[];o.add(e);for(let a of i)s+=t(a,o);return o.delete(e),this.weights[e]=s,s};for(let e of this.compound)t(e,new Set)}createValidConnections(){for(let t in this.aspects_data.combinations)for(let e of this.aspects_data.combinations[t])this.connections[t]||(this.connections[t]=[]),this.connections[e]||(this.connections[e]=[]),this.connections[t].push(e),this.connections[e].push(t)}isValidAspect(t){return this.primal.includes(t)||this.compound.includes(t)}}const f=(n,t=document.body)=>t.querySelector(n),C=(n,t=document.body)=>t.querySelectorAll(n),_=await h.create(),b=await H(),S=await O();j(S);const c=f("#node-list"),r=f("#solution-list");c&&new MutationObserver(N).observe(c,{childList:!0});function L(n){if(!r)return;const t=document.createElement("p");if(!n.path||n.path.length===0){t.textContent="No solution found",r.appendChild(t);return}const e=document.createElement("span");e.className="solution-path";const o=n.path;o.forEach((s,i)=>{const a=u(s);a.className="solution-aspect",e.appendChild(a),i<o.length-1&&e.append(" â†’ ")}),t.appendChild(e),t.append(` (${n.weight})`),r.appendChild(t)}function N(){if(!r)return;r.innerHTML="";const n=v();if(n.length<=1)return;let t=n[0];for(let e=1;e<n.length;e++){let o=e;for(;n[e]==="hex";)e++;if(e>=n.length)break;const s=e-o+2,i=n[e],a=_.findSolution(t,i,s);L(a),t=i}}function v(){if(!c)return[];const n=C("span.node",c),t=[];for(const e of n)e instanceof HTMLSpanElement&&e.dataset.aspect&&t.push(e.dataset.aspect);return t}function y(n){if(!c)return;const t=u(n);t.className="node",t.onclick=()=>t.remove(),c.appendChild(t)}function j(n){const t=f("#aspect-buttons");if(t){t.appendChild(E("hex","Empty Hex",()=>y("hex")));for(const e of n)t.appendChild(E(e,b[e]||e,()=>y(e)))}}function E(n,t,e){const o=document.createElement("button");o.className="aspect-button",o.id=n,o.title=t;const s=u(n);return o.appendChild(s),o.onclick=e,o}function u(n){const t=document.createElement("span");t.className="aspect",t.dataset.aspect=n;const e=document.createElement("img");return e.src=`/aspects/${n}.png`,e.title=b[n]||n,t.appendChild(e),t}async function H(){const n=await fetch("/translations.json");if(!n.ok)throw new Error("Failed to fetch translations");const t=await n.json();for(const e in t){let o=t[e];Array.isArray(o)&&(o=o.map(s=>s.split(" ").map(i=>i[0].toUpperCase()+i.slice(1).toLowerCase()).join(" ")),t[e]=o.join(", "))}return t}async function O(){const n=await fetch("/aspects.json");if(!n.ok)throw new Error("Failed to fetch aspects");const t=await n.json();if(Array.isArray(t.primal)&&Array.isArray(t.compound))return[...t.primal,...t.compound];throw new Error("Invalid aspects data format")}
